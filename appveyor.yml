os: test

environment:
  BINTRAY_API_KEY:
    secure: AGZJlJvqTJR3lySeBoANrPYyWfgLJciSqTZm3/ZEPbUx4dQ9m1fiWGY3RYBGaYOq
  BINTRAY_API_USERNAME:
    secure: QyZ6LhunNhgW3l/1aiGROg==

init:
  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

install:
  - C:\Python35\Scripts\pip install requests
  - C:\Python35\python -u gui\qt\deploy-scripts\appveyor_helper.py install
  - md build_32
  - md build_64
  - md build_static_32
  - md build_static_64

build_script:
  - cd build_32
  - C:\Qt\Qt5.6.0\5.6\msvc2015\bin\qmake -spec win32-msvc2015 -tp vc "..\gui\qt\CEmu.pro"
  - msbuild CEmu.vcxproj /p:Configuration=Debug
  - msbuild CEmu.vcxproj /p:Configuration=Release
  - cd ..
  - cd build_64
  - C:\Qt\Qt5.6.0x64\5.6\msvc2015_64\bin\qmake -spec win32-msvc2015 -tp vc "..\gui\qt\CEmu.pro"
  - msbuild CEmu.vcxproj /p:Configuration=Debug /p:Platform="x64"
  - msbuild CEmu.vcxproj /p:Configuration=Release /p:Platform="x64"
  - cd ..
  - cd build_static_32
  - C:\Qt\Qt5.6.0-static\bin\qmake -spec win32-msvc2015 -tp vc "..\gui\qt\CEmu.pro"
  - msbuild CEmu.vcxproj /p:Configuration=Debug
  - msbuild CEmu.vcxproj /p:Configuration=Release
  - cd ..
  - cd build_static_64
  - C:\Qt\Qt5.6.0x64-static\bin\qmake -spec win32-msvc2015 -tp vc "..\gui\qt\CEmu.pro"
  - msbuild CEmu.vcxproj /p:Configuration=Debug /p:Platform="x64"
  - msbuild CEmu.vcxproj /p:Configuration=Release /p:Platform="x64"
  - cd ..

deploy_script:
  - C:\Python35\python -u gui\qt\deploy-scripts\appveyor_helper.py deploy
